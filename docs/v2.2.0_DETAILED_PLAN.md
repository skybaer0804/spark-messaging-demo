# v2.2.0 í”„ë¡œì íŠ¸ ëŒ€ëŒ€ì  ê°œì„  ë° ì•ˆì •í™” ìƒì„¸ ê³„íš

**ìƒíƒœ**: v2.1.0 ì™„ë£Œ â†’ v2.2.0 ì§„í–‰ ì¤‘
**ëª©í‘œ**: Spark ì•± ì•ˆì •ì„± ê°•í™”, ì „ì²´ ì•„í‚¤í…ì²˜ ì¬ì„¤ê³„
**ê¸°ê°„**: 2026-01-09 ~ (Phaseë³„ ì¶”ì •)

---

## ğŸ“‹ ëª©ì°¨

1. [Overview & í•µì‹¬ ì „ëµ](#overview--í•µì‹¬-ì „ëµ)
2. [Phase 1: ê°€ì´ë“œë¼ì¸ ê³ ë„í™” (RULES.md)](#phase-1-ê°€ì´ë“œë¼ì¸-ê³ ë„í™”-rulesmd)
3. [Phase 2: ë””ë ‰í† ë¦¬ êµ¬ì¡° ì¬í¸](#phase-2-ë””ë ‰í† ë¦¬-êµ¬ì¡°-ì¬í¸)
4. [Phase 3: ë ˆì´ì•„ì›ƒ ëŒ€ì „í™˜](#phase-3-ë ˆì´ì•„ì›ƒ-ëŒ€ì „í™˜)
5. [Phase 4: ë°ì´í„° ì•„í‚¤í…ì²˜ ê°œì„ ](#phase-4-ë°ì´í„°-ì•„í‚¤í…ì²˜-ê°œì„ )
6. [Phase 5: ë„ë©”ì¸ë³„ ìœ ìŠ¤ì¼€ì´ìŠ¤ ì•ˆì •í™”](#phase-5-ë„ë©”ì¸ë³„-ìœ ìŠ¤ì¼€ì´ìŠ¤-ì•ˆì •í™”)
7. [í…ŒìŠ¤íŠ¸ ì „ëµ & ì ê²€ë¦¬ìŠ¤íŠ¸](#í…ŒìŠ¤íŠ¸-ì „ëµ--ì ê²€ë¦¬ìŠ¤íŠ¸)
8. [.cursorrules ìˆ˜ì • ì œì•ˆ](#cursorrules-ìˆ˜ì •-ì œì•ˆ)

---

## Overview & í•µì‹¬ ì „ëµ

### í˜„í™© ë¶„ì„ (v2.1.0ê¹Œì§€)

- âœ… ê¸°ë³¸ ì±„íŒ…, í‘¸ì‹œ ì•Œë¦¼, í™”ìƒíšŒì˜ ê¸°ëŠ¥ êµ¬í˜„
- âŒ **Spark SDK ì•ˆì •ì„± ë¬¸ì œ**: ë©”ì‹œì§€ ì†ì‹¤, ì‹¤ì‹œê°„ ë™ê¸°í™” ë¶ˆì•ˆì •
- âŒ **ì•„í‚¤í…ì²˜ ë³µì¡ì„±**: í©ì–´ì§„ ë¡œì§, ë¶ˆë¶„ëª…í•œ ë°ì´í„° íë¦„
- âŒ **ìŠ¤íƒ€ì¼ ì¼ê´€ì„± ë¶€ì¡±**: ê°œë³„ íŒŒì¼ì˜ í•˜ë“œì½”ë”©ëœ ìŠ¤íƒ€ì¼ê°’

### v2.2.0 ê°œì„  í•µì‹¬

1. **ëª…í™•í•œ ê°€ì´ë“œë¼ì¸** â†’ RULES.md ì •ë¹„ë¡œ ê°œë°œì ì˜¨ë³´ë”© ì‹œê°„ ë‹¨ì¶•
2. **ìŠ¬ë¦¼í•œ êµ¬ì¡°** â†’ ë¶ˆí•„ìš”í•œ ë„ë©”ì¸ ì œê±°, í•µì‹¬ 3ê°œ ì„œë¹„ìŠ¤ ì§‘ì¤‘
3. **ê²¬ê³ í•œ ë°ì´í„° íë¦„** â†’ UserChatRoom ëª¨ë¸ ë„ì…, ë©”ì‹œì§€ ì‹œí€€ì‹±ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´
4. **ì¹´í†¡ ìˆ˜ì¤€ì˜ UX** â†’ Mobile-First ë ˆì´ì•„ì›ƒ, Slim LNB

---

## Phase 1: ê°€ì´ë“œë¼ì¸ ê³ ë„í™” (RULES.md)

### 1.1 ë””ìì¸ í† í° ì‹œìŠ¤í…œ ëª…ë¬¸í™”

#### ğŸ“ ì‘ì—… ë‚´ìš©

**íŒŒì¼**: `src/RULES.md` (ì‹ ê·œ ì‘ì„±)

```markdown
# RULES.md - ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

## 1. ë””ìì¸ í† í° 3ë‹¨ê³„ ê³„ì¸µ êµ¬ì¡°

### Primitive (ì›ì‹œê°’)

- ìƒ‰ìƒ: --gray-50, --gray-100, ..., --gray-900
- ê°„ê²©: --spacing-4, --spacing-8, --spacing-16, ...
- í…Œë‘ë¦¬: --radius-sm, --radius-base, --radius-lg, ...
- **ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§ì ‘ ì‚¬ìš© ê¸ˆì§€**

### Semantic (ì˜ë¯¸ì  ë³„ì¹­)

- í…ìŠ¤íŠ¸: --text-primary, --text-secondary, --text-muted
- ë°°ê²½: --bg-default, --bg-surface, --bg-alert, --bg-success
- í…Œë‘ë¦¬: --border-default, --border-focus
- **ê³µí†µ UI íŒ¨í„´ì— ì‚¬ìš© (Button, Input, Card ë“±)**

### Component (ì»´í¬ë„ŒíŠ¸ ì „ìš©)

- --btn-bg, --btn-text, --btn-padding
- --input-border, --input-height
- --card-border, --card-shadow, --card-padding
- **íŠ¹ì • ì»´í¬ë„ŒíŠ¸ ìµœì í™”ì—ë§Œ ì‚¬ìš©**

## 2. ìŠ¤íƒ€ì¼ ìˆ˜ì • ê·œì¹™

**í•µì‹¬ ì›ì¹™**: ê°œë³„ SCSS íŒŒì¼ì—ì„œ í•˜ë“œì½”ë”©ëœ ê°’ì„ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ”ë‹¤.

### âŒ í•˜ì§€ ë§ ê²ƒ (Bad Practice)

\`\`\`scss
.btn {
background-color: #2196F3; // ì§ì ‘ ìƒ‰ìƒê°’ ì…ë ¥
padding: 12px 20px; // ì§ì ‘ í¬ê¸°ê°’ ì…ë ¥
}
\`\`\`

### âœ… í•  ê²ƒ (Good Practice)

\`\`\`scss
// src/styles/tokens/button.scss
--btn-bg: var(--teal-500);
--btn-text: var(--white);
--btn-padding: var(--spacing-8) var(--spacing-16);

// src/components/Button.scss
.btn {
background-color: var(--btn-bg);
color: var(--btn-text);
padding: var(--btn-padding);
}
\`\`\`
```

**ê¸°ëŒ€ íš¨ê³¼**

- âœ… ìƒˆë¡œìš´ ê°œë°œì ì˜¨ë³´ë”© ì‹œê°„ **50% ê°ì†Œ**
- âœ… ìŠ¤íƒ€ì¼ ìœ ì§€ë³´ìˆ˜ **ì¤‘ì•™í™”** â†’ ì¼ê´€ì„± í–¥ìƒ
- âœ… ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©ì„± **30% í–¥ìƒ**

---

## Phase 2: ë””ë ‰í† ë¦¬ êµ¬ì¡° ì¬í¸

### 2.1 ë¶ˆí•„ìš” ë„ë©”ì¸ ì œê±°

**ëŒ€ìƒ**: `ReverseAuction` ê´€ë ¨ ëª¨ë“  íŒŒì¼/í´ë” ì‚­ì œ

\`\`\`bash
rm -rf src/domains/ReverseAuction
rm -rf src/components/ReverseAuction\*
rm -f src/api/reverseAuctionAPI.ts
rm -f server/routes/reverseAuction.js
\`\`\`

### 2.2 ì œë„¤ë¦­ ì»´í¬ë„ŒíŠ¸ í†µí•©

**ëª©í‘œ**: `ui-component/` ë‚´ì˜ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì§„ì •í•œ ì œë„¤ë¦­ í˜•íƒœë¡œ ì¬ì„¤ê³„

\`\`\`
src/ui-components/
â”œâ”€â”€ Button/
â”œâ”€â”€ Input/
â”œâ”€â”€ Card/
â”œâ”€â”€ Dialog/
â”œâ”€â”€ Avatar/
â””â”€â”€ Badge/
\`\`\`

### 2.3 ë„ë©”ì¸ ì¤‘ì‹¬ ì•„í‚¤í…ì²˜

**í•µì‹¬ 3ê°œ ë„ë©”ì¸**: Chat, Notification, VideoMeeting

\`\`\`
src/domains/
â”œâ”€â”€ Chat/
â”‚ â”œâ”€â”€ components/
â”‚ â”œâ”€â”€ hooks/
â”‚ â”œâ”€â”€ types/
â”‚ â”œâ”€â”€ utils/
â”‚ â””â”€â”€ **tests**/
â”œâ”€â”€ Notification/
â””â”€â”€ VideoMeeting/
\`\`\`

---

## Phase 3: ë ˆì´ì•„ì›ƒ ëŒ€ì „í™˜

### 3.1 UI íŒ¨ëŸ¬ë‹¤ì„ ë³€í™” (ì¹´í†¡ ìŠ¤íƒ€ì¼)

**í•µì‹¬ LNB (Left Navigation Bar)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬     â”‚  Chat List           â”‚
â”‚  ğŸ””     â”‚  (í•„í„°ë§ í¬í•¨)       â”‚
â”‚  ğŸ“¹     â”‚                      â”‚
â”‚  âš™ï¸     â”‚  Filter:             â”‚
â”‚  ğŸ‘¤     â”‚  [ All ] [ Unread ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ë°˜ì‘í˜• Grid

**Desktop**: LNB + ChatWindow + SidePanel
**Mobile**: ChatWindow + í•˜ë‹¨ íƒ­ë°”

---

## Phase 4: ë°ì´í„° ì•„í‚¤í…ì²˜ ê°œì„ 

### 4.1 ì‹ ê·œ ëª¨ë¸: UserChatRoom (Junction Table)

\`\`\`javascript
{
userId: ObjectId (ref: User),
roomId: ObjectId (ref: ChatRoom),
unreadCount: Number,
lastReadMessageId: ObjectId,
isPinned: Boolean,
notificationEnabled: Boolean
}
\`\`\`

### 4.2 Message ëª¨ë¸ ë³´ê°•

\`\`\`javascript
{
// ê¸°ì¡´ í•„ë“œ
roomId, senderId, content, type, readBy, timestamp,

// [NEW] ì‹œí€€ìŠ¤ ë²ˆí˜¸
sequenceNumber: Number,

// [NEW] ì‚­ì œ ì¶”ì 
isDeleted: Boolean,
deletedBy: 'sender' | 'all',

// [NEW] ë‚™ê´€ì  ì—…ë°ì´íŠ¸
tempId: String
}
\`\`\`

### 4.3 VideoMeeting ëª¨ë¸ ê³ ë„í™”

\`\`\`javascript
{
roomId, organizerId, title, status,
maxParticipants: Number,
recordingUrl: String,
activeParticipants: [{ userId, joinedAt, leftAt }]
}
\`\`\`

---

## Phase 5: ë„ë©”ì¸ë³„ ìœ ìŠ¤ì¼€ì´ìŠ¤ ì•ˆì •í™”

### UC-C1: ì±„íŒ…ë°© ëª©ë¡ ì‹¤ì‹œê°„ ë™ê¸°í™”

**Flow**:

1. í´ë¼ì´ì–¸íŠ¸ëŠ” ì†Œì¼“ ì—°ê²° ì‹œ ìì‹ ì˜ userId ë“±ë¡
2. ì„œë²„ëŠ” ìƒˆ ë©”ì‹œì§€ ë°œìƒ ì‹œ, ìˆ˜ì‹ ìë“¤ì˜ unreadCount ì¦ê°€
3. ìˆ˜ì‹ ìë“¤ì—ê²Œ ROOM_LIST_UPDATED ì´ë²¤íŠ¸ ì†¡ì‹ 

### UC-C2: ë‚™ê´€ì  ì—…ë°ì´íŠ¸

**Flow**:

1. í”„ë¡ íŠ¸: tempId + ê°€ì§œ ë©”ì‹œì§€ë¥¼ ì¦‰ì‹œ UIì— ë Œë”ë§ (Status: 'sending')
2. ë°±ì—”ë“œ: ë©”ì‹œì§€ ì €ì¥ í›„ \_id + tempId ì‘ë‹µ
3. í”„ë¡ íŠ¸: tempId â†’ ì‹¤ì œ \_id ë§¤í•‘, status ë³€ê²½

### UC-C3: Reconnection Sync

**Flow**:

1. í´ë¼ì´ì–¸íŠ¸ê°€ ë§ˆì§€ë§‰ sequenceNumberë¥¼ ì„œë²„ì— ì „ì†¡
2. ì„œë²„ëŠ” í•´ë‹¹ ì‹œí€€ìŠ¤ ì´í›„ì˜ ë©”ì‹œì§€ë§Œ ì‘ë‹µ
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¤‘ë³µ ì œê±° í›„ ë³‘í•©

### UC-N1: ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ í‘¸ì‹œ

**Logic**:

1. ì„œë²„ê°€ ì‚¬ìš©ìì˜ í˜„ì¬ activeRoom í™•ì¸ (Redis)
2. í˜„ì¬ ë°©ê³¼ ë©”ì‹œì§€ ë°©ì´ ì¼ì¹˜í•˜ë©´ í‘¸ì‹œ ìƒëµ
3. ì¼ì¹˜í•˜ì§€ ì•Šê±°ë‚˜ ì˜¤í”„ë¼ì¸ì´ë©´ Web-Push ë°œì†¡

### UC-V1: ì±„íŒ…ë°© ì—°ë™ íšŒì˜ ìƒì„±

**Flow**:

1. ì±„íŒ…ë°© ë‚´ë¶€ 'í™”ìƒíšŒì˜' ì•„ì´ì½˜ í´ë¦­
2. VideoMeeting ìƒì„± (status: 'ongoing')
3. ì‹œìŠ¤í…œ ë©”ì‹œì§€ + í‘¸ì‹œ ì•Œë¦¼ ìë™ ë°œì†¡

---

## í…ŒìŠ¤íŠ¸ ì „ëµ & ì ê²€ë¦¬ìŠ¤íŠ¸

### ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸

**Phase 1: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸** (Jest + RTL)

- ê° ë„ë©”ì¸ì˜ í›…, ìœ í‹¸, ì»´í¬ë„ŒíŠ¸

**Phase 2: í†µí•© í…ŒìŠ¤íŠ¸** (Supertest)

- í”„ë¡ íŠ¸ì—”ë“œ + ë°±ì—”ë“œ API í†µí•©

**Phase 3: E2E í…ŒìŠ¤íŠ¸** (Playwright)

- ì „ì²´ ë©”ì‹œì§€ íë¦„, í™”ìƒíšŒì˜, ëª¨ë°”ì¼ ë°˜ì‘í˜•

**Phase 4: ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**

- 1000ê°œ ë©”ì‹œì§€ ë¡œë“œ (<100ms)
- 100ê°œ ë©”ì‹œì§€ Sync (<500ms)

### ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

**Core Functionality**

- [ ] ì±„íŒ…ë°© ëª©ë¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- [ ] ë©”ì‹œì§€ ë°œì†¡ â†’ DB â†’ ì†Œì¼“ â†’ ìˆ˜ì‹  (ì „ ê³¼ì •)
- [ ] ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (ëŠë¦° ë„¤íŠ¸ì›Œí¬)
- [ ] Reconnection Sync (ìë™ ëˆ„ë½ ë©”ì‹œì§€)
- [ ] ì•ˆì½ìŒ ì¹´ìš´íŠ¸ ì •í™•ì„±
- [ ] ë°©ë³„ ì•Œë¦¼ ON/OFF

**Real-time & Socket**

- [ ] ì†Œì¼“ ì´ë²¤íŠ¸ ë¡œê·¸ í™•ì¸
- [ ] ì¤‘ë³µ ë©”ì‹œì§€ ì—†ìŒ
- [ ] ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥ (sequenceNumber)
- [ ] í‘¸ì‹œ: ì˜¤í”„ë¼ì¸ë§Œ ì „ì†¡

**Database**

- [ ] UserChatRoom í…Œì´ë¸” ì •ìƒ
- [ ] Message.sequenceNumber ì¸ë±ìŠ¤
- [ ] Migration ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

**UI/UX**

- [ ] LNB ì•„ì´ì½˜ ë°˜ì‘í˜•
- [ ] Chat Tab í•„í„°ë§ ì‘ë™
- [ ] Notification/VideoMeeting í‘œì‹œ
- [ ] Settings ê¸°ë³¸ ì„¤ì •

**Cross-browser & Device**

- [ ] Chrome, Safari, Firefox
- [ ] iPhone, Android í‘¸ì‹œ ì•Œë¦¼
- [ ] PWA ì˜¤í”„ë¼ì¸ ëª¨ë“œ

---

## .cursorrules ìˆ˜ì • ì œì•ˆ

ê¸°ì¡´ "ìŠ¤íƒ€ì¼ ê°€ì´ë“œ" ì„¹ì…˜ ìœ ì§€ + 8ê°œ ìƒˆ ì„¹ì…˜ ì¶”ê°€

1. **Socket & Real-time ê°œë°œ ê·œì¹™**
2. **ë‚™ê´€ì  ì—…ë°ì´íŠ¸ & Reconnection Sync**
3. **ì—ëŸ¬ ì²˜ë¦¬ & ë¡œê¹…**
4. **í…ŒìŠ¤íŠ¸ ì‘ì„± ê·œì¹™**
5. **ì„±ëŠ¥ ìµœì í™”**
6. **ë„ë©”ì¸ë³„ êµ¬ì¡°**
7. **íƒ€ì… ì•ˆì •ì„±**
8. **Output Language: Korean**

ìì„¸í•œ ë‚´ìš©ì€ `.cursorrules_v2.2.0_PROPOSAL.md` ì°¸ê³ 

---

## ê°œë°œ íƒ€ì„ë¼ì¸

| Phase | ì‘ì—…                     | ì˜ˆìƒ ê¸°ê°„ | ìš°ì„ ìˆœìœ„  |
| ----- | ------------------------ | --------- | --------- |
| 1     | RULES.md + ë””ìì¸ í† í°   | 3-4ì¼     | ğŸ”´ High   |
| 2     | ë””ë ‰í† ë¦¬ êµ¬ì¡° ì¬í¸       | 2-3ì¼     | ğŸ”´ High   |
| 3     | ë ˆì´ì•„ì›ƒ ëŒ€ì „í™˜          | 5-7ì¼     | ğŸŸ  Medium |
| 4     | ë°ì´í„° ëª¨ë¸ ë§ˆì´ê·¸ë ˆì´ì…˜ | 4-5ì¼     | ğŸ”´ High   |
| 5     | ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„ & ì•ˆì •í™” | 7-10ì¼    | ğŸ”´ High   |
| 6     | í…ŒìŠ¤íŠ¸                   | 5-7ì¼     | ğŸŸ  Medium |

**ì´ ì˜ˆìƒ**: 26-37ì¼ (ì•½ 4-5ì£¼)
