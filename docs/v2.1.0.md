# 프로젝트 개선 및 고도화 TODO (v2.1.0)

## 1. 채팅 (Chat) 기능 개선

- [ ] **메시지 정렬 로직 수정**
  - `ChatMessageItem`에서 `message.type === 'sent'` 기준을 현재 로그인한 사용자의 ID와 `senderId` 비교 방식으로 변경
  - 내가 보낸 메시지는 우측, 상대방이 보낸 메시지는 좌측에 배치되도록 UI 정렬 고도화
- [ ] **실시간 메시지 동기화 이슈 해결 (제안사항 적용)**
  - `ChatService.ts`의 `onRoomMessage`에서 수신된 메시지의 `roomId`가 현재 활성화된 방의 ID와 일치하는지 검증 로직 강화
  - 개발 모드에서 소켓 이벤트 수신을 실시간 모니터링할 수 있는 **Debug Mode** 인터페이스 추가
- [ ] **채팅방 내 유저 목록 표시**
  - 채팅창 진입 시 우측 또는 상단에 현재 채팅방 참여자 목록 UI 추가
- [ ] **채팅방 생성 및 초대 UI 고도화**
  - 신규 채팅방 생성 시 전체 유저 리스트를 표시하고 멀티 선택(Checkbox)을 통해 초대하는 기능 구현
- [ ] **채팅방 나가기 기능 추가**
  - 채팅방 리스트 아이템에서 마우스 우클릭 시 '나가기' 컨텍스트 메뉴 표시 및 기능 구현

## 2. 푸쉬 메시지 (Push Message) 고도화

- [ ] **`PushSubscription` DB 구조 개편**
  - 여러 기기 대응을 위해 `User` 모델 내 단일 필드가 아닌 `pushSubscribe` 독립 테이블(또는 Collection) 생성
- [ ] **기기별 알림 허용/차단 로직 구현**
  - 클라이언트에서 `Notification.requestPermission()` 연동 및 서버 DB에 기기별 토큰 등록/삭제 API 구현
- [ ] **상황별 푸시 알림 발송 로직 (방법 A 적용)**
  - 사용자의 현재 **"활성 채팅방 ID"를 서버(Redis 또는 Memory)에서 추적**하여, 사용자가 해당 방에 들어가 있는 경우 푸시 발송 생략
  - 채팅 초대 시 또는 사용자가 오프라인/다른 방에 있을 때만 푸시 발송
- [ ] **알림 설정 UI 구현**
  - 전체 알림 ON/OFF 설정
  - 채팅방별(Room level) 개별 알림 ON/OFF 설정 기능 및 서버 연동

## 3. 조직 (Organization) 관리

- [ ] **조직(Organization) DB 구축**
  - `Organization` 테이블 생성: 회사명, 부서(dept1, dept2) 정보 포함
- [ ] **유저 모델 확장**
  - `User` 모델에 `orgId` (Organization 참조 ID) 필드 추가
- [ ] **조직 단위 초대 및 성능 최적화 (제안사항 적용)**
  - 채팅방 초대 시 특정 조직/부서 전체를 선택 가능하게 구현
  - 대규모 인원 초대 시 `ChatRoom` 멤버 리스트에 개별 유저 ID 대신 `orgId`를 직접 포함하는 **가상 멤버십(Virtual Membership)** 개념 도입 검토 (성능 최적화)

## 4. 권한 (Permission) 시스템

- [ ] **사용자 역할(Role) 정의**
  - `Admin`, `Normal`, `Guest`로 구분된 Role 시스템 도입
  - `User` 모델에 `role` 필드 추가 및 기본값 'Normal' 설정
- [ ] **권한 기반 확장성 확보**
  - 향후 기능별 세부 권한 체크를 위한 로직(Base Permission Logic) 설계

## 5. 공지사항 및 알림 (Notification)

- [ ] **공지사항 DB 구축**
  - `Notification` (공지사항) 테이블 생성: 제목, 내용, 발송 시간, 예약 여부 등
- [ ] **Admin 전용 발송 기능**
  - Admin 권한을 가진 사용자만 전체 유저 대상 Notification 발송 가능하도록 제한
- [ ] **전체 푸시 발송 로직**
  - 공지사항 등록 시 모든 유저의 모든 등록된 Device로 `web-push` 발송
- [ ] **예약 발송 시스템 (단기/장기 로드맵 적용)**
  - **1단계 (현재)**: 년.월.일.시 단위까지만 설정 가능하게 구현. 서버측 스케줄러를 **1시간 단위**로 실행하여 발송 대상 체크
  - **2단계 (추후)**: Redis 기반의 **BullMQ**를 도입하여 분 단위 정밀 발송 및 예약 작업의 안정성(Persistence) 확보

## 6. 역경매 (Reverse Auction) 고도화 (화상회의 전환 제안 적용)

- [ ] **채팅방 타입 확장**
  - `ChatRoom` 모델에 `type` 필드 추가 (`DEFAULT`, `VIDEO_MEETING`)
  - 일반 채팅 리스트와 화상회의(구 역경매) 리스트 필터링 로직 적용
- [ ] **화상회의 전용 로직 및 UI**
  - 역경매의 입찰 로직 대신 **WebRTC 기반의 화상 미팅 기능**을 메인으로 확장
  - 화상회의 예약 생성 시 발송 대상자들에게 `web-push` 알림 연동

## 7. 리팩토링 및 네이밍 변경 (중요)

- [ ] **역경매(ReverseAuction) -> 화상회의(VideoConference) 전면 전환**
  - 모든 파일명 변경: `ReverseAuction.tsx` -> `VideoConference.tsx` 등
  - 코드 내 변수명, 함수명, 컴포넌트명 전면 수정
  - API 엔드포인트 및 관련 객체 네이밍 일관성 있게 변경
